/*
 * Tpfw library
 * 
 * @license: GPLv3
 * @author: ThemesPond
 */
jQuery(function($){"use strict";var e=$(document);$.fn.tpfwImagePicker=function(){var t={},n=function(e){var t=[];if(""!=e){var n=e.split(",");for(var i in n){var a=n[i].split("|");t.push(a[0])}}return t};e.on("click",".tpfw-image_picker .add_images",function(e){e.preventDefault();var i=$(this),a=i.closest(".tpfw-image_picker"),l=a.find('input[type="hidden"]');if(t[a.attr("id")])return void t[a.attr("id")].open();t[a.attr("id")]=wp.media.frames.file_frame=wp.media({title:"Add Images",button:{text:"Add Images"},library:{type:"image"},multiple:a.data("multiple")}),t[a.attr("id")].on("open",function(){var e,i;""!=(e=n(l.val()))&&(i=t[a.attr("id")].state().get("selection"),$(e).each(function(e,t){var n;n=wp.media.attachment(t),n.fetch(),i.add(n?[n]:[])}))}),t[a.attr("id")].on("select",function(){var e,i;e=[],i=t[a.attr("id")].state().get("selection");var o=n(l.val()),r="";i.map(function(t){t=t.toJSON();var n=t.sizes.hasOwnProperty("thumbnail")?t.sizes.thumbnail.url:t.url;""!=o&&-1!==$.inArray(t.id.toString(),o)||(r+='<li class="added" data-id="'+t.id+'">\n                                    <div class="inner">\n                                        <img alt="'+t.title+'" src="'+n+'"/>\n                                    </div>\n                                    <a href="#" class="remove"></a>\n                                </li>',n=n.replace(tpfw_var.upload_url,""),e.push(t.id+"|"+encodeURIComponent(n)))}),e.length>0&&(a.data("multiple")?(""!=o&&(e=o.concat(e)),a.find(".image_list").append(r)):a.find(".image_list").html(r),l.val(e).change())}),t[a.attr("id")].open()}),e.on("click",".tpfw-image_picker .remove",function(e){e.preventDefault();var t=$(this),n=t.closest(".tpfw-image_picker").find('input[type="hidden"]'),i=n.val(),a=t.closest("li").index();""!=i&&(i=i.split(","),delete i[a],i=i.filter(function(e){return e})),n.val(i).change(),t.closest("li").remove()}),$.fn.sortable&&$(".tpfw-image_picker .image_list").sortable({stop:function(e,t){var n=[],i=$(t.item[0]).parent();i.find("li").each(function(){n.push($(this).attr("data-id"))}),i.closest(".tpfw-image_picker").find('input[type="hidden"]').val(n)}})},$.fn.tpfwLink=function(){e.on("click",".tpfw-link .link_button",function(e){console.log("Click!"),e.preventDefault();var t,n,i,a,l,o,r,s,p;t=$(this).closest(".tpfw-link"),n=t.find("input.tpfw_value"),i=t.find(".url-label"),a=t.find(".title-label"),l=n.data("json"),o=$("#wp-link-submit"),r=$('<input type="button" name="tpfw_link-submit" id="tpfw_link-submit" class="button-primary" value="Set Link">'),o.hide(),$("#tpfw_link-submit").remove(),r.insertBefore(o),s=$('<div class="link-target tpfw-link-nofollow"><label><span></span> <input type="checkbox" id="tpfw-link-nofollow"> Add nofollow option to link</label></div>'),$("#link-options .tpfw-link-nofollow").remove(),s.insertAfter($("#link-options .link-target")),setTimeout(function(){var e=$("#most-recent-results").css("top");$("#most-recent-results").css("top",parseInt(e)+s.height())},200),p=window.wpLink,p.open("content"),"string"==typeof l.url&&$("#wp-link-url").length?$("#wp-link-url").val(l.url):$("#url-field").val(l.url),"string"==typeof l.url&&$("#wp-link-text").length?$("#wp-link-text").val(l.title):$("#link-title-field").val(l.title),$("#wp-link-target").length?$("#wp-link-target").prop("checked",l.target.length):$("#link-target-checkbox").prop("checked",l.target.length),$("#tpfw-link-nofollow").length&&$("#tpfw-link-nofollow").prop("checked",l.rel.length),r.unbind("click.tpfwLink").bind("click.tpfwLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var t,l={};l.url=$("#wp-link-url").length?$("#wp-link-url").val():$("#url-field").val(),l.title=$("#wp-link-text").length?$("#wp-link-text").val():$("#link-title-field").val();var s=$($("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return l.target=s[0].checked?" _blank":"",l.rel=$("#tpfw-link-nofollow")[0].checked?"nofollow":"",t=$.map(l,function(e,t){return"string"==typeof e&&0<e.length?t+":"+encodeURIComponent(e):void 0}).join("|"),n.val(t).change(),n.data("json",l),i.html(l.url+l.target),a.html(l.title),p.close("noReset"),window.wpLink.textarea="",o.show(),r.unbind("click.tpfwLink"),r.remove(),$("#wp-link-cancel").unbind("click.tpfwLink"),s.attr("checked",!1),$("#most-recent-results").css("top",""),$("#tpfw-link-nofollow").attr("checked",!1),!1}),$("#wp-link-cancel").unbind("click.tpfwLink").bind("click.tpfwLink",function(e){return e.preventDefault(),p.close("noReset"),r.unbind("click.tpfwLink"),r.remove(),$("#wp-link-cancel").unbind("click.tpfwLink"),$("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1}),$("#wp-link-close").unbind("click").bind("click.tpfwCloseLink",function(e){return e.preventDefault(),p.close("noReset"),r.unbind("click.tpfwLink"),r.remove(),$("#wp-link-cancel").unbind("click.tpfwLink"),$("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1})})},$.fn.tpfwMap=function(){if(window.hasOwnProperty("google"))return this.each(function(e,t){if(!t.id.includes("__i__")){var n=$(this),i={};i.zoom=14,i.map=new google.maps.Map(n.find(".map_canvas")[0],{zoom:4,center:new google.maps.LatLng(40.590377,-97.726872)}),i.marker=null,i.overideMap=function(e){null!=i.marker&&(i.marker.setMap(null),i.marker=null),i.marker=new google.maps.Marker({position:e,draggable:!0,animation:google.maps.Animation.DROP,icon:i.iconMarker}),i.map.setCenter(e),i.map.setZoom(i.zoom),i.marker.setMap(i.map),google.maps.event.addListener(i.marker,"dragend",i.onDragMarker),google.maps.event.addListener(i.map,"zoom_changed",i.onZoomChanged)},i.onDragMarker=function(e){var t=e.latLng,a=t.lat()+","+t.lng()+"|"+i.zoom;n.find("input.tpfw_value").val(a).change()},i.onZoomChanged=function(e){i.zoom=i.map.getZoom();var t=n.find("input.tpfw_value").val();if(""!=$.trim(t)){t=t.split("|");var a=t[0]+"|"+i.zoom;n.find("input.tpfw_value").val(a).change()}},i.onLoad=function(){var e=n.find("input.tpfw_value").val();if(n.addClass("map_loaded"),""!=$.trim(e)){e=e.split("|");var t=e[0].split(",");t=new google.maps.LatLng($.trim(t[0]),$.trim(t[1])),i.zoom=""!=$.trim(e[1])?parseInt(e[1]):14,i.overideMap(t)}},n.find(".js-map_search").geocomplete().bind("geocode:result",function(e,t){var a=t.geometry.location,l=a.lat()+","+a.lng()+"|"+i.zoom;n.find("input.tpfw_value").val(l).change(),i.overideMap(a)}),setTimeout(i.onLoad,500)}})},$.fn.tpfwRepeater=function(){$(this).each(function(){var e=$(this).repeater({defaultValues:{},show:function(){$(this).slideDown()},hide:function(e){$(this).slideUp(e)},ready:function(e){},render:{image_picker:function(e,t,n){var i=n.split(",");if(i.length>0){var a="";$.each(i,function(e,t){t=t.split("|"),2===t.length&&(a+='<li class="added" data-id="'+t[0]+'">\n                                                    <div class="inner">\n                                                        <img alt="" src="'+tpfw_var.upload_url+decodeURIComponent(t[1])+'"/>\n                                                    </div>\n                                                    <a href="#" class="remove"></a>\n                                                </li>')}),e.parent().find(".image_list").append(a)}},color_picker:function(e,t,n){e.val(n),e.wpColorPicker({change:function(e,t){$(e.target).val(t.color.toString()).change()}})},icon_picker:function(e,t,n){e.val(n).change(),e.fontIconPicker()},checkbox:function(e,t,n){if(""!=n){n=n.split(",");var i=e.next();for(var a in n)i.find('input[value="'+n[a]+'"]').attr("checked","checked")}},select:function(e,t,n){var i=e.parent().find("select");if(""!=n){"string"==typeof n&&(n=n.split(","));for(var a in n)i.find('option[value="'+n[a]+'"]').attr("selected","selected");i.change()}void 0!==i.attr("multiple")&&i.selectize({plugins:["remove_button","drag_drop"],onChange:function(e){$(this)[0].$wrapper.closest(".repeater-col-field").find("input.tpfw_value").val(e).change()}})},autocomplete:function(e,t,n){var i=e.parent().find("select");if(""!=n){"string"==typeof n&&(n=n.split(","));for(var a in n)i.find('option[value="'+n[a]+'"]').attr("selected","selected");i.change()}i.tpfwAutocomplete()},link:function(e,t,n){var i=n.split("|"),a={};if(i.length>1){for(var l in i){var o=i[l].split(":");a[o[0]]=decodeURIComponent(o[1])}e.data("json",a),e.parent().find(".url-label").html(a.url+a.target),e.parent().find(".title-label").html(a.title)}},datetime:function(e,t,n){e.datetimepicker(e.data())}}}),t=e.data("value");"object"==typeof t&&e.setList(t),e.find("div[data-rpt_dependency]").length&&e.find("div[data-rpt_dependency]").initRepeaterDependency()}),e.on("click",".tpfw-repeater [data-repeater-edit], .tpfw-repeater .tpfw-widget-title h4",function(t){var n=$(this).closest(".tpfw-widget");n.hasClass("open")?n.find(".tpfw-widget-inside").slideUp("fast",function(){n.removeClass("open")}):n.find(".tpfw-widget-inside").slideDown("fast",function(){n.addClass("open"),e.trigger("tpfw-repeater-item-opened",[n])}),t.preventDefault()})},$.fn.tpfwTypography=function(){var e={},t=!1,n=function(e,t,n){var i={"font-family":t.value},a=e.find(".subsets select"),l=e.find(".variants select"),o=a[0].selectize,r=l[0].selectize;if(""!=t.variants){var s=t.variants.split(","),p=[],c=tpfw_var.variants;for(var d in t.variants){var f=c.hasOwnProperty(s[d])?c[s[d]]:s[d];p.push({text:f,value:s[d]})}if(r.enable(),r.clearOptions(),r.addOption(p),"object"==typeof n&&n.hasOwnProperty("variants")){var u=n.variants.split(",");r.addItems(u)}else r.addItems(s);i.variants=t.variants}else r.clearOptions(),r.disable();if(""!=t.subsets){var v=t.subsets.split(","),p=[],h=tpfw_var.subsets;for(var d in v){var f=h.hasOwnProperty(v[d])?h[v[d]]:v[d];p.push({text:f,value:v[d]})}if(o.enable(),o.clearOptions(),o.addOption(p),"object"==typeof n&&n.hasOwnProperty("subsets")){var w=n.subsets.split(",");o.addItems(w)}else $.inArray("latin",v)>=0&&(o.addItem("latin"),i.subsets="latin")}else o.clearOptions(),o.disable();"function"==typeof n&&n(i)},i=$(this),a=i.find(".font_family select");i.find(".variants select").selectize({plugins:["remove_button"],create:!1,onChange:function(n){if(!t){var i=$(this)[0].$wrapper.closest(".tpfw-typography"),a=i.data("id"),l=e[a];if(""!=i.data("value")&&l.hasOwnProperty("variants")){l.variants=n.join(",");var o=encodeURIComponent(JSON.stringify(l));e[a]=l,i.find(".tpfw_value").val(o).change()}}}}),i.find(".subsets select").selectize({plugins:["remove_button"],create:!1,onChange:function(n){if(!t){var i=$(this)[0].$wrapper.closest(".tpfw-typography"),a=i.data("id"),l=e[a];if(""!=i.data("value")&&l.hasOwnProperty("subsets")){l.subsets=n.join(",");var o=encodeURIComponent(JSON.stringify(l));e[a]=l,i.find(".tpfw_value").val(o).change()}}}}),a.selectize({labelField:"label",valueField:"value",searchField:"label",create:!1,options:tpfw_var.fonts,render:{option:function(e,t){return"<div class='option' data-value='"+e.value+"' data-variants='"+e.variants+"' data-subsets='"+e.subsets+"'>"+e.label+" </div>"}},onInitialize:function(){var t=$(this)[0].$wrapper.closest(".tpfw-typography"),n=t.data("id");e[n]={};var i=t.data("value");if(""!=i){var a=JSON.parse(decodeURIComponent(i));a.hasOwnProperty("font-family")&&(e[n]=a,$(this)[0].addItem(a["font-family"]))}},onChange:function(i){if(t=!0,""!=i){var a=$(this)[0].$wrapper.closest(".tpfw-typography"),l=a.data("id"),o=e[l];o.hasOwnProperty("font-family")&&o["font-family"]===i?n(a,this.options[i],o):n(a,this.options[i],function(t){o["font-family"]=t["font-family"],o.subsets=t.subsets,o.variants=t.variants;var n=encodeURIComponent(JSON.stringify(o));a.find(".tpfw_value").val(n).change(),e[l]=o}),t=!1}}}),i.on("change",".subrow input, .subrow select",function(t){var n=$(this).data("key"),i=$(this),a=i.closest(".tpfw-typography"),l=a.data("id");if(""!=i.val()){e[l][n]=i.val();var o=encodeURIComponent(JSON.stringify(e[l]));a.find(".tpfw_value").val(o).change()}t.preventDefault()})},$.fn.tpfwAutocomplete=function(){$(this).selectize({valueField:"value",searchField:"label",labelField:"label",options:[],create:!1,plugins:["remove_button","drag_drop"],render:{option:function(e,t){return'<div class="option" data-value="'+e.value+'">#'+e.value+" - "+t(e.label)+"</div>"}},load:function(e,t){var n=$(this)[0].$wrapper.closest(".tpfw-field"),i=n.data("min_length");if(e.length<parseInt(i))return t();var a=n.data("ajax_type"),l=n.data("ajax_value");$.ajax({url:ajaxurl,type:"GET",data:{action:"tpfw_autocomplete_"+a,types:l,s:e},error:function(){t()},success:function(e){t(e)}})}})},$.fn.initWidgetDependency=function(){$(this).each(function(){var e=$(this).data("dependency"),t=$(this).data("param_name");if(void 0!=e&&_.isObject(e)){var n="#";$(this).closest(".widget").length&&(n="#widget-"+$(this).closest(".widget").find("input.widget-id").val()+"-");var i=Object.keys(e);_.each(i,function(t){e[n+t]=e[t],delete e[t]});$("#"+t+".tpfw_value").dependsOn(e)}})},$.fn.initRepeaterDependency=function(){$(this).each(function(){var e=$(this).closest(".tpfw_repeater__item").index(),t=$(this).closest(".tpfw-repeater").attr("data-name")+"-"+e+"-",n=$(this).data("rpt_dependency"),i=$(this).data("param_name");if(void 0!=n&&_.isObject(n)){var a=Object.keys(n);_.each(a,function(e){n["#"+t+e]=n[e],delete n[e]});$("#"+t+i+".tpfw_value").dependsOn(n)}})},$.fn.initMenuDependency=function(){$(this).each(function(){var e=$(this).data("dependency"),t=$(this).data("param_name"),n=$(this).data("menu_item");if(void 0!=e&&"object"==typeof e){var i=Object.keys(e);$.each(i,function(t,i){e["#"+i+"-"+n]=e[i],delete e[i]});$("#"+t+".tpfw_value").dependsOn(e)}})},$.fn.initDependency=function(){$(this).each(function(){var e=$(this).data("dependency"),t=$(this).data("param_name");if(void 0!=e&&"object"==typeof e){var n=Object.keys(e);$.each(n,function(t,n){e["#"+n]=e[n],delete e[n]});$("#"+t+".tpfw_value").dependsOn(e)}})}});var Tpfw_Repeater_Item=function(e,t,n){"use strict";var i=this;this.list=e,this.container=t,this.control=e.prev(".tpfw_value"),this.container.on("keyup change",".tpfw_value",function(e){i.setValues()}),this.setValues=function(){var e=[];i.list.find("[data-repeater-item]").each(function(){var t={};jQuery(this).find(".tpfw_value").each(function(){var e=jQuery(this);if("radio"!=e.attr("type")||"radio"==e.attr("type")&&e.is(":checked")){var n=jQuery(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];t[n]=jQuery(this).val()}}),e.push(t)}),i.control.val(JSON.stringify(e)).trigger("change")},n&&i.setValues()};